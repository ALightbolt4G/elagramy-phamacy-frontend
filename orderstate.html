<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª - ØµÙŠØ¯Ù„ÙŠØ© Ø³Ø§Ø±Ø© Ø§Ù„Ø¹Ø¬Ø±Ù…ÙŠ</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --primary-light: #c7d2fe;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: var(--gray-800);
            min-height: 100vh;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { 
            background: var(--gradient);
            color: white;
            padding: 25px 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 50%);
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .back-btn:hover { 
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(-5px);
        }
        
        .client-badge {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            position: relative;
            z-index: 1;
        }
        
        .client-name { 
            font-weight: bold; 
            font-size: 16px; 
            color: white;
        }
        
        .client-address { 
            font-size: 13px; 
            color: rgba(255, 255, 255, 0.9); 
        }
        
        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
        .orders-container { 
            display: grid; 
            gap: 25px; 
            margin-bottom: 40px;
        }
        
        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù„Ø¨ */
        .order-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--gray-200);
            position: relative;
            overflow: hidden;
        }
        
        .order-card:hover { 
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
        }
        
        .order-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }
        
        /* Ù‡ÙŠØ¯Ø± Ø§Ù„Ø·Ù„Ø¨ */
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-100);
        }
        
        .order-id { 
            font-size: 1.8rem; 
            font-weight: 800; 
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .order-date { 
            color: var(--gray-600); 
            font-size: 0.95rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .order-date i {
            color: var(--primary-light);
        }
        
        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ */
        .order-status {
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .status-pending { 
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        
        .status-confirmed { 
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .status-preparing { 
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            color: #5b21b6;
            border: 1px solid #d8b4fe;
        }
        
        .status-on_the_way { 
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: #0369a1;
            border: 1px solid #7dd3fc;
        }
        
        .status-delivered { 
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
            border: 1px solid #86efac;
        }
        
        .status-cancelled { 
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        /* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ */
        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .detail-item { 
            background: var(--gray-50); 
            padding: 20px;
            border-radius: 12px;
            border-right: 4px solid var(--primary);
            transition: all 0.3s;
        }
        
        .detail-item:hover {
            background: var(--gray-100);
            transform: translateY(-3px);
        }
        
        .detail-label { 
            font-size: 0.85rem; 
            color: var(--gray-600);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-value { 
            font-weight: 700; 
            font-size: 1.4rem;
            color: var(--gray-800);
        }
        
        .detail-subtext {
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-top: 5px;
        }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ø±ÙˆØ´ØªØ© */
        .prescription-section {
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 12px;
            border: 1px solid #bfdbfe;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--info);
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        
        .prescription-text {
            background: white;
            padding: 20px;
            border-radius: 10px;
            line-height: 1.7;
            color: var(--gray-800);
            border: 1px solid #dbeafe;
            font-size: 0.95rem;
        }
        
        /* Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± */
        .images-gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .image-item {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #dbeafe;
            transition: all 0.3s;
        }
        
        .image-item:hover {
            transform: scale(1.05);
            border-color: var(--info);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }
        
        .image-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
        }
        
        .view-image {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
            color: white;
            font-size: 1.5rem;
        }
        
        .image-item:hover .view-image {
            opacity: 1;
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø·Ù„Ø¨ */
        .order-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid var(--gray-100);
        }
        
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            flex: 1;
        }
        
        .track-btn { 
            background: linear-gradient(135deg, var(--info) 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .track-btn:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .details-btn { 
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .details-btn:hover { 
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }
        
        /* Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª */
        .no-orders {
            text-align: center;
            padding: 80px 40px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            border: 2px dashed var(--gray-200);
        }
        
        .no-orders i { 
            font-size: 5rem; 
            color: var(--primary-light); 
            margin-bottom: 25px;
            opacity: 0.7;
        }
        
        .no-orders h2 { 
            color: var(--gray-800);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .no-orders p { 
            color: var(--gray-600);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        /* Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« */
        .refresh-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 40px auto;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(79, 70, 229, 0.3);
        }
        
        .refresh-btn:hover { 
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.4);
        }
        
        .refresh-btn:active { transform: translateY(-1px); }
        
        /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            border-radius: 12px;
            font-weight: 600;
            z-index: 1000;
            animation: slideDown 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            max-width: 500px;
            width: 90%;
            display: flex;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideDown {
            from { top: -100px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }
        
        .success { 
            background: rgba(16, 185, 129, 0.9); 
            color: white; 
            border-left: 5px solid #047857;
        }
        
        .error { 
            background: rgba(239, 68, 68, 0.9); 
            color: white; 
            border-left: 5px solid #991b1b;
        }
        
        .info { 
            background: rgba(59, 130, 246, 0.9); 
            color: white; 
            border-left: 5px solid #1d4ed8;
        }
        
        /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            
            header { 
                flex-direction: column; 
                gap: 15px; 
                text-align: center;
                padding: 20px;
            }
            
            .order-header { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 15px; 
            }
            
            .order-details { 
                grid-template-columns: 1fr; 
            }
            
            .order-actions { 
                flex-direction: column; 
            }
            
            .images-gallery {
                justify-content: center;
            }
            
            .image-item {
                width: 100px;
                height: 100px;
            }
        }
        
        @media (max-width: 480px) {
            .order-card {
                padding: 20px;
            }
            
            .action-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .no-orders {
                padding: 40px 20px;
            }
            
            .no-orders i {
                font-size: 3.5rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <button class="back-btn" onclick="window.location.href='index.html'">
                <i class="fas fa-home"></i>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>
            <h1 style="font-size: 1.8rem;">ğŸ“‹ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
            <div id="clientInfo"></div>
        </header>
        
        <div id="message" class="message" style="display: none;"></div>
        
        <div class="orders-container" id="ordersContainer">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
        </div>
        
        <button class="refresh-btn" onclick="loadOrders()" id="refreshBtn">
            <i class="fas fa-sync-alt"></i> 
            <span id="refreshText">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span>
            <span id="refreshLoading" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i>
            </span>
        </button>
    </div>

    <script>
        const API_BASE = 'https://elagramy-phamacy-production.up.railway.app/api';
        let clientId = null;
        let clientData = null;
        
        function showMessage(text, type = 'info', duration = 5000) {
            const msgDiv = document.getElementById('message');
            msgDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${text}</span>
            `;
            msgDiv.className = `message ${type}`;
            msgDiv.style.display = 'flex';
            
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, duration);
        }
        
        function getStatusInfo(status) {
            const statuses = {
                'pending': { 
                    text: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', 
                    class: 'status-pending',
                    icon: 'fas fa-clock'
                },
                'confirmed': { 
                    text: 'ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯', 
                    class: 'status-confirmed',
                    icon: 'fas fa-check-circle'
                },
                'preparing': { 
                    text: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±', 
                    class: 'status-preparing',
                    icon: 'fas fa-box'
                },
                'on_the_way': { 
                    text: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', 
                    class: 'status-on_the_way',
                    icon: 'fas fa-truck'
                },
                'delivered': { 
                    text: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', 
                    class: 'status-delivered',
                    icon: 'fas fa-check-double'
                },
                'cancelled': { 
                    text: 'Ù…Ù„ØºÙŠ', 
                    class: 'status-cancelled',
                    icon: 'fas fa-times-circle'
                }
            };
            return statuses[status] || { 
                text: status, 
                class: 'status-pending',
                icon: 'fas fa-question-circle'
            };
        }
        
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    return 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                }
                
                return date.toLocaleDateString('ar-EG', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®:', error);
                return dateString || 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            }
        }
        

            // ================ Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§ ================
function displayOrders(orders) {
    const container = document.getElementById('ordersContainer');
    
    if (!orders || orders.length === 0) {
        container.innerHTML = `
            <div class="no-orders">
                <i class="fas fa-clipboard-list"></i>
                <h2>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</h2>
                <p>Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                <button class="refresh-btn" onclick="window.location.href='order.html'" 
                        style="margin: 20px auto 0; display: inline-flex;">
                    <i class="fas fa-shopping-cart"></i> 
                    Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†
                </button>
            </div>
        `;
        return;
    }
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
    orders.sort((a, b) => new Date(b.created_at || b.order_date) - new Date(a.created_at || a.order_date));
    
    let ordersHtml = '';
    
    orders.forEach(order => {
        const statusInfo = getStatusInfo(order.order_state || order.status || 'pending');
        const formattedDate = formatDate(order.created_at || order.order_date);
        const orderNumber = order.id ? order.id.toString().padStart(6, '0') : '000000';
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
        const totalAmount = order.total_amount || 0;
        const deliveryFee = order.delivery_fee || 0;
        
        // Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        const itemsCount = order.items_count || 
                          (order.order_details ? order.order_details.length : 0) ||
                          (order.items ? order.items.length : 1);
        
        ordersHtml += `
            <div class="order-card" data-order-id="${order.id}">
                <div class="order-header">
                    <div>
                        <div class="order-id">
                            <i class="fas fa-receipt"></i>
                            Ø§Ù„Ø·Ù„Ø¨ #${orderNumber}
                        </div>
                        <div class="order-date">
                            <i class="far fa-calendar"></i>
                            ${formattedDate}
                        </div>
                        ${order.branch_name ? `
                            <div class="order-date" style="margin-top: 5px;">
                                <i class="fas fa-store"></i>
                                ${order.branch_name}
                            </div>
                        ` : ''}
                    </div>
                    <div class="order-status ${statusInfo.class}">
                        <i class="${statusInfo.icon}"></i>
                        ${statusInfo.text}
                    </div>
                </div>
                
                <div class="order-details">
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-money-bill-wave"></i>
                            Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                        </div>
                        <div class="detail-value">${totalAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡</div>
                        ${deliveryFee > 0 ? `
                            <div class="detail-subtext">
                                ${(totalAmount - deliveryFee).toFixed(2)} + ${deliveryFee} ØªÙˆØµÙŠÙ„
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="detail-item">
                        <div class="detail-label">
                            <i class="fas fa-boxes"></i>
                            Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                        </div>
                        <div class="detail-value">${itemsCount}</div>
                        <div class="detail-subtext">
                            Ù…Ù†ØªØ¬${itemsCount !== 1 ? 'Ø§Øª' : ''}
                        </div>
                    </div>
                    
                    ${order.delivery_person_id ? `
                        <div class="detail-item">
                            <div class="detail-label">
                                <i class="fas fa-user-tie"></i>
                                Ù…ÙˆØ¸Ù Ø§Ù„ØªÙˆØµÙŠÙ„
                            </div>
                            <div class="detail-value">
                                ${order.delivery_persons?.name || 'ÙŠØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²'}
                            </div>
                            ${order.delivery_persons?.phone ? `
                                <div class="detail-subtext">
                                    <i class="fas fa-phone"></i>
                                    ${order.delivery_persons.phone}
                                </div>
                            ` : ''}
                        </div>
                    ` : ''}
                </div>
                
                ${order.customer_notes ? `
                    <div class="prescription-section">
                        <div class="section-title">
                            <i class="fas fa-file-medical"></i>
                            Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ù„Ø¨
                        </div>
                        <div class="prescription-text">
                            ${order.customer_notes}
                        </div>
                    </div>
                ` : ''}
                
                <div class="order-actions">
                    <button class="action-btn track-btn" onclick="trackOrder(${order.id})">
                        <i class="fas fa-map-marker-alt"></i>
                        ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨
                    </button>
                    <button class="action-btn details-btn" onclick="viewOrderDetails(${order.id})">
                        <i class="fas fa-info-circle"></i>
                        Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
                    </button>
                    ${order.order_state === 'pending' ? `
                        <button class="action-btn" onclick="cancelOrder(${order.id})" 
                                style="background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%); color: white;">
                            <i class="fas fa-times"></i>
                            Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
    });
    
    container.innerHTML = ordersHtml;
}
// ================ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© ================

        async function loadOrders() {
    if (!clientId) {
        showMessage('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 2000);
        return;
    }
    
    const refreshBtn = document.getElementById('refreshBtn');
    const refreshText = document.getElementById('refreshText');
    const refreshLoading = document.getElementById('refreshLoading');
    
    refreshBtn.disabled = true;
    refreshText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
    refreshLoading.style.display = 'inline-block';
    
    try {
        console.log(`ğŸ“ Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ${clientId}...`);
        
        // ğŸ”§ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ù€ Backend
        // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù‡Ùˆ: GET /api/clients/:clientId/orders/:branchId?
        // Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹ Ø£Ùˆ ÙØ±Ø¹ Ù…Ø¹ÙŠÙ†
        
        // Ø£ÙˆÙ„Ø§Ù‹: Ø¬Ù„Ø¨ ÙØ±ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„
        const branchesResponse = await fetch(`${API_BASE}/clients/${clientId}/branches`);
        let allOrders = [];
        
        if (branchesResponse.ok) {
            const branchesData = await branchesResponse.json();
            
            if (branchesData.success && branchesData.data && branchesData.data.length > 0) {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† ÙƒÙ„ ÙØ±Ø¹
                const branchPromises = branchesData.data.map(async (branch) => {
                    try {
                        const ordersResponse = await fetch(
                            `${API_BASE}/clients/${clientId}/orders/${branch.branch_id || branch.branches?.id}`
                        );
                        
                        if (ordersResponse.ok) {
                            const ordersData = await ordersResponse.json();
                            if (ordersData.success && ordersData.data) {
                                // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ±Ø¹ Ù„ÙƒÙ„ Ø·Ù„Ø¨
                                return ordersData.data.map(order => ({
                                    ...order,
                                    branch_name: branch.branches?.name || 'ÙØ±Ø¹'
                                }));
                            }
                        }
                        return [];
                    } catch (error) {
                        console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙØ±Ø¹ ${branch.branch_id}:`, error);
                        return [];
                    }
                });
                
                const ordersArrays = await Promise.all(branchPromises);
                allOrders = ordersArrays.flat();
                
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙØ±ÙˆØ¹ØŒ Ø¬Ø±Ø¨ API Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø·Ù„Ø¨Ø§Øª
                const directResponse = await fetch(`${API_BASE}/orders?client_id=${clientId}`);
                if (directResponse.ok) {
                    const directData = await directResponse.json();
                    if (directData.success) {
                        allOrders = directData.data || [];
                    }
                }
            }
        }
        
        // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ø§ØªØŒ Ø¬Ø±Ø¨ Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ
        if (allOrders.length === 0) {
            console.log('ğŸ”„ ØªØ¬Ø±Ø¨Ø© API Ø¨Ø¯ÙŠÙ„...');
            const fallbackResponse = await fetch(`${API_BASE}/orders?client=${clientId}`);
            
            if (fallbackResponse.ok) {
                const fallbackData = await fallbackResponse.json();
                if (fallbackData.success) {
                    allOrders = fallbackData.data || [];
                }
            }
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        if (allOrders.length > 0) {
            displayOrders(allOrders);
            showMessage(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allOrders.length} Ø·Ù„Ø¨`, 'success', 2000);
            
            // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ localStorage Ù„Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
            localStorage.setItem('user_orders_cache', JSON.stringify({
                orders: allOrders,
                timestamp: Date.now()
            }));
        } else {
            displayOrders([]);
        }
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', error);
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹
        try {
            const cached = localStorage.getItem('user_orders_cache');
            if (cached) {
                const cacheData = JSON.parse(cached);
                const cacheAge = Date.now() - cacheData.timestamp;
                
                // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø£Ù‚Ù„ Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚
                if (cacheAge < 5 * 60 * 1000 && cacheData.orders && cacheData.orders.length > 0) {
                    displayOrders(cacheData.orders);
                    showMessage('ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹', 'info', 2000);
                    return;
                }
            }
        } catch (cacheError) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©:', cacheError);
        }
        
        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨Ø§Øª
        if (error.message.includes('404') || error.message.includes('Ù„Ø§ ØªÙˆØ¬Ø¯')) {
            displayOrders([]);
        } else {
            showMessage('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±', 'error');
        }
    } finally {
        refreshBtn.disabled = false;
        refreshText.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©';
        refreshLoading.style.display = 'none';
    }
}


        async function cancelOrder(orderId) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE}/orders/${orderId}/status`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                status: 'cancelled'
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setTimeout(() => {
                loadOrders(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            }, 1000);
        } else {
            throw new Error(data.message || 'ÙØ´Ù„ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨');
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨:', error);
        showMessage('ØªØ¹Ø°Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨', 'error');
    }
}


        function viewImage(imageUrl, orderId, imageIndex) {
            if (!imageUrl) {
                showMessage('Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±', 'error');
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                z-index: 2000;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="position: absolute; top: 20px; right: 20px;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: white; font-size: 2rem; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div style="max-width: 90%; max-height: 80%; overflow: auto;">
                    <img src="${imageUrl}" 
                         alt="ØµÙˆØ±Ø© Ø±ÙˆØ´ØªØ© Ø§Ù„Ø·Ù„Ø¨ ${orderId}" 
                         style="max-width: 100%; max-height: 100%; border-radius: 10px;">
                </div>
                
                <div style="color: white; margin-top: 20px; text-align: center;">
                    <p>ØµÙˆØ±Ø© Ø§Ù„Ø±ÙˆØ´ØªØ© - Ø§Ù„Ø·Ù„Ø¨ #${orderId}</p>
                    <a href="${imageUrl}" 
                       target="_blank" 
                       style="color: var(--primary-light); text-decoration: none; display: inline-flex; align-items: center; gap: 8px; margin-top: 10px;">
                        <i class="fas fa-external-link-alt"></i>
                        ÙØªØ­ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                    </a>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙˆØ±Ø©
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ESC
            document.addEventListener('keydown', function closeOnEsc(e) {
                if (e.key === 'Escape') {
                    modal.remove();
                    document.removeEventListener('keydown', closeOnEsc);
                }
            });
        }
        
        async function viewOrderDetails(orderId) {
    try {
        showMessage('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„...', 'info');
        
        console.log(`ğŸ“‹ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ${orderId}...`);
        
        // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: API Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        let response;
        try {
            response = await fetch(`${API_BASE}/orders/${orderId}`);
        } catch (fetchError) {
            console.error('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±:', fetchError);
            throw new Error('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
        }
        
        console.log('ğŸ“¡ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:', response.status);
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© 500 (Ø®Ø·Ø£ Ø³ÙŠØ±ÙØ±)
        if (response.status === 500) {
            console.log('âš ï¸ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¹Ø§Ø¯ Ø¨Ø®Ø·Ø£ 500ØŒ Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯ÙˆØ¯Ø©...');
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙÙŠ localStorage
            const cachedOrders = localStorage.getItem('user_orders_cache');
            if (cachedOrders) {
                try {
                    const cacheData = JSON.parse(cachedOrders);
                    const cachedOrder = cacheData.orders?.find(o => o.id == orderId);
                    
                    if (cachedOrder) {
                        console.log('âœ… Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹');
                        showOrderDetailsModal(cachedOrder);
                        return;
                    }
                } catch (cacheError) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©:', cacheError);
                }
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²Ù†Ø©ØŒ Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø§Ø³Ø¨Ø©
            showMessage('ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©. Ø¬Ø§Ø±Ù Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©.', 'warning');
            
            // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø³Ø·Ø© Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø©
            const orderElement = document.querySelector(`[data-order-id="${orderId}"]`);
            if (orderElement) {
                const orderNumber = orderId.toString().padStart(6, '0');
                const orderDate = orderElement.querySelector('.order-date')?.textContent || '';
                const orderTotal = orderElement.querySelector('.detail-value')?.textContent || '0 Ø¬Ù†ÙŠÙ‡';
                
                const simpleOrder = {
                    id: orderId,
                    order_number: orderNumber,
                    created_at: orderDate,
                    total_amount: parseFloat(orderTotal) || 0,
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                    branches: { name: 'Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' },
                    clients: { 
                        name: clientData?.name || 'Ø§Ù„Ø¹Ù…ÙŠÙ„', 
                        phone: clientData?.phone || '',
                        address: clientData?.address || ''
                    }
                };
                
                showOrderDetailsModal(simpleOrder);
                return;
            }
            
            throw new Error('ØªØ¹Ø°Ø± Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨');
        }
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ Ù†Ø§Ø¬Ø­Ø§Ù‹
        if (response.ok) {
            const data = await response.json();
            
            if (data.success) {
                console.log('âœ… ØªÙ… Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
                const order = data.data.order || data.data;
                showOrderDetailsModal(order);
            } else {
                throw new Error(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„');
            }
        } else if (response.status === 404) {
            throw new Error('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
        } else {
            throw new Error(`Ø®Ø·Ø£ ${response.status}`);
        }
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:', error);
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù…Ù†Ø§Ø³Ø¨Ø©
        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„';
        
        if (error.message.includes('Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯')) {
            errorMessage = 'Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
        } else if (error.message.includes('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„')) {
            errorMessage = 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±';
        } else if (error.message.includes('404')) {
            errorMessage = 'Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
        } else if (error.message.includes('500')) {
            errorMessage = 'Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹';
        }
        
        showMessage(errorMessage, 'error');
        
        // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ù…Ø¨Ø³Ø·Ø© Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
        setTimeout(() => {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                z-index: 2000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 30px; max-width: 400px; width: 100%; text-align: center;">
                    <div style="color: var(--danger); font-size: 4rem; margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    
                    <h3 style="color: var(--gray-800); margin-bottom: 15px;">
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #${orderId}
                    </h3>
                    
                    <p style="color: var(--gray-600); margin-bottom: 20px; line-height: 1.6;">
                        ${errorMessage}
                    </p>
                    
                    <div style="background: var(--gray-100); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="color: var(--gray-800); font-weight: bold; margin-bottom: 10px;">
                            Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:
                        </p>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <a href="tel:01234522133" 
                               style="color: var(--primary); text-decoration: none; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <i class="fas fa-phone"></i>
                                Ø§ØªØµÙ„ Ø¨Ù†Ø§: 01234522133
                            </a>
                            <p style="color: var(--gray-600); font-size: 0.9rem;">
                                Ø£Ùˆ Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹
                            </p>
                        </div>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 10px; cursor: pointer; font-weight: bold;">
                        Ø­Ø³Ù†Ø§Ù‹
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }, 500);
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
async function showOrderDetailsModal(order) {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        animation: fadeIn 0.3s ease;
    `;
    
    // Ø¥Ø¶Ø§ÙØ© CSS Ù„Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    `;
    document.head.appendChild(style);
    
    // Ø¨Ù†Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
    const orderNumber = order.id ? order.id.toString().padStart(6, '0') : '000000';
    const orderDate = formatDate(order.created_at);
    const totalAmount = order.total_amount || 0;
    const deliveryFee = order.delivery_fee || 0;
    const subtotal = totalAmount - deliveryFee;
    
    // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
    const statusInfo = getStatusInfo(order.order_state || order.status || 'pending');
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø£ÙˆÙ„ÙŠ Ù„Ù„Ù†Ø§ÙØ°Ø©
    modal.innerHTML = `
        <div style="background: white; border-radius: 16px; padding: 0; max-width: 800px; width: 100%; max-height: 90vh; overflow: hidden; animation: slideUp 0.4s ease;">
            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
            <div style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 25px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <h3 style="margin: 0 0 8px 0; font-size: 22px; display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-file-invoice"></i>
                            ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ #${orderNumber}
                        </h3>
                        <div style="opacity: 0.9; font-size: 14px; display: flex; align-items: center; gap: 10px;">
                            <span><i class="fas fa-calendar"></i> ${orderDate}</span>
                            <span>â€¢</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 20px;">
                                ${statusInfo.text}
                            </span>
                        </div>
                    </div>
                    <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                            style="background: rgba(255, 255, 255, 0.2); border: none; width: 40px; height: 40px; border-radius: 10px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.3s;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div style="background: rgba(255, 255, 255, 0.15); padding: 12px; border-radius: 10px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">
                            <i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                        </div>
                        <div style="font-size: 20px; font-weight: bold;">
                            ${totalAmount.toFixed(2)} Ø¬.Ù…
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.15); padding: 12px; border-radius: 10px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">
                            <i class="fas fa-truck"></i> Ø§Ù„ØªÙˆØµÙŠÙ„
                        </div>
                        <div style="font-size: 20px; font-weight: bold;">
                            ${deliveryFee.toFixed(2)} Ø¬.Ù…
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.15); padding: 12px; border-radius: 10px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">
                            <i class="fas fa-store"></i> Ø§Ù„ÙØ±Ø¹
                        </div>
                        <div style="font-size: 16px; font-weight: bold;">
                            ${order.branches?.name || order.branch_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© -->
            <div style="padding: 30px; max-height: 60vh; overflow-y: auto;" id="orderModalContent">
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 40px; color: var(--primary); margin-bottom: 20px;"></i>
                    <p style="color: var(--gray-600);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨...</p>
                </div>
            </div>
            
            <!-- Ø§Ù„ÙÙˆØªØ± -->
            <div style="background: var(--gray-50); padding: 20px; border-top: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center;">
                <div style="color: var(--gray-600); font-size: 14px;">
                    <i class="fas fa-info-circle"></i> 
                    Ø§Ù„Ø·Ù„Ø¨ Ù…Ù†: ${order.clients?.name || clientData?.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="window.print()" 
                            style="background: white; color: var(--primary); border: 2px solid var(--primary); padding: 10px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: bold; transition: all 0.3s;">
                        <i class="fas fa-print"></i>
                        Ø·Ø¨Ø§Ø¹Ø©
                    </button>
                    <button onclick="shareOrder(${order.id})" 
                            style="background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: bold; transition: all 0.3s;">
                        <i class="fas fa-share-alt"></i>
                        Ù…Ø´Ø§Ø±ÙƒØ©
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.remove();
        }
    });
    
    // Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„Ø©
    await loadFullOrderDetails(order.id);
}

async function loadFullOrderDetails(orderId) {
    try {
        console.log(`ğŸ“‹ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #${orderId}`);
        
        const response = await fetch(`${API_BASE}/orders/${orderId}`);
        const result = await response.json();
        
        console.log('ğŸ“Š Ø§Ø³ØªØ¬Ø§Ø¨Ø© API:', {
            success: result.success,
            order_number: result.data?.order?.order_number,
            branch: result.data?.order?.branch,
            client: result.data?.order?.client,
            items_count: result.data?.items?.length
        });
        
        if (result.success) {
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ Ù„Ù„ØªØ­Ù‚Ù‚
            console.log('ğŸ” ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:', {
                branch: result.data.order.branch,
                client: result.data.order.client,
                delivery_info: result.data.order.delivery_info,
                items: result.data.items
            });
            
            updateOrderModalContent(result.data);
        } else {
            showErrorInModal(result.message || 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨');
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:', error);
        showErrorInModal('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
    }
}

function updateOrderModalContent(orderData) {
    const modalContent = document.getElementById('orderModalContent');
    const order = orderData.order;
    
    console.log('ğŸ” [UI] ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:', {
        order: order,
        branch: order.branch,
        client: order.client,
        items: orderData.items
    });
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    if (!order) {
        console.error('âŒ [UI] Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
        return;
    }
    
    console.log('âœ… [UI] Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯Ø©:', {
        order_number: order.order_number,
        branch_name: order.branch?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯ ÙÙŠ order.branch',
        client_address: order.client?.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯ ÙÙŠ order.client',
        delivery_fee: order.delivery_fee
    });
    
    // Ø¬Ù…Ø¹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    const allItems = (orderData.items || []).map(item => ({
        ...item,
        total: (item.unit_price || 0) * item.quantity
    }));
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹
    const itemsTotal = allItems.reduce((sum, item) => sum + item.total, 0);
    const deliveryFee = order.delivery_fee || order.delivery_info?.fee || 0;
    const finalTotal = order.total_amount || (itemsTotal + deliveryFee);
    
    // Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨
    const statusInfo = getStatusInfo(order.order_state || order.status);
    
    // ğŸ”¥ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
    modalContent.innerHTML = `
        <div style="margin-bottom: 25px;">
            <h4 style="color: var(--gray-800); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--gray-200); display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-shopping-basket"></i>
                Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (${allItems.length})
            </h4>
            
            <div style="background: white; border-radius: 12px; border: 1px solid var(--gray-200); overflow: hidden;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: var(--gray-50); border-bottom: 2px solid var(--gray-200);">
                            <th style="padding: 15px; text-align: right; color: var(--gray-700); font-weight: 600; width: 50px;">#</th>
                            <th style="padding: 15px; text-align: right; color: var(--gray-700); font-weight: 600;">Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th style="padding: 15px; text-align: center; color: var(--gray-700); font-weight: 600; width: 100px;">Ø§Ù„Ø³Ø¹Ø±</th>
                            <th style="padding: 15px; text-align: center; color: var(--gray-700); font-weight: 600; width: 100px;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th style="padding: 15px; text-align: center; color: var(--gray-700); font-weight: 600; width: 120px;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${allItems.map((item, index) => `
                            <tr style="border-bottom: 1px solid var(--gray-100); transition: background 0.2s;" 
                                onmouseenter="this.style.background='var(--gray-50)'" 
                                onmouseleave="this.style.background='white'">
                                <td style="padding: 15px; text-align: center; color: var(--gray-600);">
                                    ${index + 1}
                                </td>
                                <td style="padding: 15px; text-align: right;">
                                    <div style="font-weight: bold; color: var(--gray-900); margin-bottom: 5px;">
                                        ${item.product_name || 'Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                                    </div>
                                    <div style="font-size: 13px; color: var(--gray-600);">
                                        <span style="background: ${item.type === 'drug' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(59, 130, 246, 0.1)'}; 
                                                color: ${item.type === 'drug' ? 'var(--success)' : '#3b82f6'}; 
                                                padding: 3px 8px; border-radius: 4px; font-size: 12px;">
                                            ${item.type === 'drug' ? 'Ø¯ÙˆØ§Ø¡' : 'Ù…Ø³ØªØ­Ø¶Ø±'}
                                        </span>
                                        ${item.product_details ? `
                                            <div style="margin-top: 5px; color: var(--gray-500); font-size: 12px;">
                                                <i class="fas fa-info-circle"></i> ${item.product_details}
                                            </div>
                                        ` : ''}
                                        ${item.notes ? `
                                            <div style="margin-top: 5px; color: var(--gray-500); font-size: 12px;">
                                                <i class="fas fa-sticky-note"></i> ${item.notes}
                                            </div>
                                        ` : ''}
                                    </div>
                                </td>
                                <td style="padding: 15px; text-align: center; color: var(--gray-800); font-weight: 600;">
                                    ${item.unit_price?.toFixed(2) || '0.00'} Ø¬.Ù…
                                </td>
                                <td style="padding: 15px; text-align: center; color: var(--gray-800);">
                                    ${item.quantity}
                                </td>
                                <td style="padding: 15px; text-align: center; color: var(--primary); font-weight: bold;">
                                    ${item.total.toFixed(2)} Ø¬.Ù…
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ğŸ”¥ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ - Ù…Ø¹Ø¯Ù„Ø© -->
        <div style="margin-bottom: 25px;">
            <h4 style="color: var(--gray-800); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--gray-200); display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-truck"></i>
                Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„
            </h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <!-- Ø§Ù„ÙØ±Ø¹ -->
                <div style="background: var(--gray-50); padding: 15px; border-radius: 10px; border: 1px solid var(--gray-200);">
                    <div style="color: var(--gray-600); font-size: 14px; margin-bottom: 5px;">
                        <i class="fas fa-store"></i> Ø§Ù„ÙØ±Ø¹
                    </div>
                    <div style="font-weight: bold; color: var(--gray-800);">
                        ${order.branch?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                    </div>
                </div>
                
                <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ -->
                <div style="background: var(--gray-50); padding: 15px; border-radius: 10px; border: 1px solid var(--gray-200);">
                    <div style="color: var(--gray-600); font-size: 14px; margin-bottom: 5px;">
                        <i class="fas fa-map-marker-alt"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„
                    </div>
                    <div style="font-weight: bold; color: var(--gray-800);">
                        ${order.client?.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                    </div>
                </div>
                
                <!-- Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„ØªÙˆØµÙŠÙ„ -->
                <div style="background: var(--gray-50); padding: 15px; border-radius: 10px; border: 1px solid var(--gray-200);">
                    <div style="color: var(--gray-600); font-size: 14px; margin-bottom: 5px;">
                        <i class="fas fa-user"></i> Ù…Ù†Ø¯ÙˆØ¨ Ø§Ù„ØªÙˆØµÙŠÙ„
                    </div>
                    <div style="font-weight: bold; color: var(--gray-800);">
                        ${order.delivery_person?.name || 'Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ Ø¨Ø¹Ø¯'}
                    </div>
                </div>
                
                <!-- Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
                ${order.client?.phone ? `
                    <div style="background: var(--gray-50); padding: 15px; border-radius: 10px; border: 1px solid var(--gray-200);">
                        <div style="color: var(--gray-600); font-size: 14px; margin-bottom: 5px;">
                            <i class="fas fa-phone"></i> Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„
                        </div>
                        <div style="font-weight: bold; color: var(--gray-800);">
                            <a href="tel:${order.client.phone}" style="color: var(--primary); text-decoration: none;">
                                ${order.client.phone}
                            </a>
                        </div>
                    </div>
                ` : ''}
            </div>
        </div>
        
        <!-- Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
        <div style="background: white; border-radius: 12px; border: 2px solid var(--gray-200); padding: 25px; margin-top: 20px;">
            <h4 style="color: var(--gray-800); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid var(--gray-200); display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-file-invoice-dollar"></i>
                Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            </h4>
            
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed var(--gray-200);">
                    <span style="color: var(--gray-600);">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span>
                    <span style="color: var(--gray-800); font-weight: 600;">${itemsTotal.toFixed(2)} Ø¬.Ù…</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed var(--gray-200);">
                    <span style="color: var(--gray-600);">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„:</span>
                    <span style="color: var(--gray-800); font-weight: 600;">${deliveryFee.toFixed(2)} Ø¬.Ù…</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-top: 2px solid var(--gray-200);">
                    <span style="color: var(--primary); font-size: 18px; font-weight: bold;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                    <span style="color: var(--primary); font-size: 24px; font-weight: bold;">${finalTotal.toFixed(2)} Ø¬.Ù…</span>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, ${statusInfo.color}20 0%, ${statusInfo.color}10 100%); border-radius: 10px; border: 1px solid ${statusInfo.color}30;">
                <div style="display: flex; align-items: center; gap: 10px; color: ${statusInfo.color};">
                    <i class="fas ${statusInfo.icon}"></i>
                    <span style="font-weight: bold; font-size: 16px;">${statusInfo.text}</span>
                    <span style="margin-right: auto; font-size: 14px; opacity: 0.8;">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</span>
                </div>
            </div>
        </div>
    `;
    
    // ğŸ”¥ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡ÙŠØ¯Ø± ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© (Ø§Ù„Ø£Ù‡Ù…)
    setTimeout(() => {
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ ÙÙŠ Ø§Ù„Ù‡ÙŠØ¯Ø±
        const headerElement = document.querySelector('.cart-header');
        if (headerElement) {
            headerElement.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <h3 style="margin: 0 0 8px 0; font-size: 22px; display: flex; align-items: center; gap: 12px;">
                            <i class="fas fa-file-invoice"></i>
                            ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ #${order.order_number || order.id}
                        </h3>
                        <div style="opacity: 0.9; font-size: 14px; display: flex; align-items: center; gap: 10px;">
                            <span><i class="fas fa-calendar"></i> ${formatDate(order.created_at)}</span>
                            <span>â€¢</span>
                            <span><i class="fas fa-store"></i> ${order.branch?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                            <span>â€¢</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 20px;">
                                ${statusInfo.text}
                            </span>
                        </div>
                    </div>
                    <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                            style="background: rgba(255, 255, 255, 0.2); border: none; width: 40px; height: 40px; border-radius: 10px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.3s;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø© -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div style="background: rgba(255, 255, 255, 0.15); padding: 12px; border-radius: 10px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">
                            <i class="fas fa-money-bill-wave"></i> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                        </div>
                        <div style="font-size: 20px; font-weight: bold;">
                            ${finalTotal.toFixed(2)} Ø¬.Ù…
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.15); padding: 12px; border-radius: 10px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">
                            <i class="fas fa-truck"></i> Ø§Ù„ØªÙˆØµÙŠÙ„
                        </div>
                        <div style="font-size: 20px; font-weight: bold;">
                            ${deliveryFee.toFixed(2)} Ø¬.Ù…
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.15); padding: 12px; border-radius: 10px;">
                        <div style="font-size: 13px; opacity: 0.9; margin-bottom: 5px;">
                            <i class="fas fa-store"></i> Ø§Ù„ÙØ±Ø¹
                        </div>
                        <div style="font-size: 16px; font-weight: bold;">
                            ${order.branch?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </div>
                    </div>
                </div>
            `;
        }
    }, 100);
}

function showErrorInModal(message) {
    const modalContent = document.getElementById('orderModalContent');
    modalContent.innerHTML = `
        <div style="text-align: center; padding: 40px 20px;">
            <div style="width: 80px; height: 80px; background: rgba(239, 68, 68, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
                <i class="fas fa-exclamation-triangle" style="font-size: 40px; color: var(--danger);"></i>
            </div>
            <h3 style="color: var(--gray-700); margin-bottom: 10px;">${message}</h3>
            <p style="color: var(--gray-600); margin-bottom: 20px;">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
            <button onclick="window.location.reload()" 
                    style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">
                <i class="fas fa-redo"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
            </button>
        </div>
    `;
}

function viewImage(imageUrl) {
    const viewer = document.createElement('div');
    viewer.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 3000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
    `;
    
    viewer.innerHTML = `
        <div style="position: relative; max-width: 90%; max-height: 90%;">
            <img src="${imageUrl}" 
                 style="max-width: 100%; max-height: 90vh; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);"
                 alt="ØµÙˆØ±Ø© Ø§Ù„Ø±ÙˆØ´ØªØ©">
            <button onclick="this.parentElement.parentElement.remove()" 
                    style="position: absolute; top: -40px; left: 0; background: rgba(255,255,255,0.2); border: none; width: 40px; height: 40px; border-radius: 50%; color: white; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-times"></i>
            </button>
            <div style="position: absolute; bottom: -40px; right: 0; color: white; font-size: 14px; opacity: 0.8;">
                Ø§Ø¶ØºØ· ESC Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø¥ØºÙ„Ø§Ù‚
            </div>
        </div>
    `;
    
    document.body.appendChild(viewer);
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙˆØ±Ø©
    viewer.addEventListener('click', function(e) {
        if (e.target === viewer) {
            viewer.remove();
        }
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø¶ØºØ· ESC
    document.addEventListener('keydown', function closeViewer(e) {
        if (e.key === 'Escape') {
            viewer.remove();
            document.removeEventListener('keydown', closeViewer);
        }
    });
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø©
function getStatusInfo(status) {
    const statuses = {
        pending: { text: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', color: '#f59e0b', icon: 'fa-clock' },
        confirmed: { text: 'ØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯', color: '#3b82f6', icon: 'fa-check-circle' },
        preparing: { text: 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±', color: '#8b5cf6', icon: 'fa-box' },
        on_the_way: { text: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚', color: '#6366f1', icon: 'fa-truck' },
        delivered: { text: 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…', color: '#10b981', icon: 'fa-check-double' },
        cancelled: { text: 'Ù…Ù„ØºÙ‰', color: '#ef4444', icon: 'fa-times-circle' }
    };
    
    return statuses[status] || statuses.pending;
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
function formatDate(dateString) {
    if (!dateString) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    
    const date = new Date(dateString);
    return date.toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}
// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
function showOrderModal(details, orderId, order) {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        animation: fadeIn 0.3s ease;
    `;
    
    modal.innerHTML = `
        <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: var(--primary); margin: 0;">
                    <i class="fas fa-info-circle"></i>
                    ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #${orderId}
                </h3>
                <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                        style="background: none; border: none; font-size: 1.5rem; color: var(--gray-600); cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="white-space: pre-line; font-family: inherit; line-height: 1.8; color: var(--gray-800); margin-bottom: 20px;">
                ${details.replace(/\n/g, '<br>')}
            </div>
            
            <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: center;">
                <button onclick="window.print()" 
                        style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-print"></i>
                    Ø·Ø¨Ø§Ø¹Ø©
                </button>
                <button onclick="shareOrderDetails(${orderId}, '${details}')" 
                        style="background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-share"></i>
                    Ù…Ø´Ø§Ø±ÙƒØ©
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· CSS Ù„Ù„Ø­Ø±ÙƒØ©
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    `;
    document.head.appendChild(style);
}

// Ø¯Ø§Ù„Ø© Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„
function shareOrderDetails(orderId, details) {
    if (navigator.share) {
        navigator.share({
            title: `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #${orderId}`,
            text: details,
            url: window.location.href
        });
    } else {
        // Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        navigator.clipboard.writeText(`ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #${orderId}\n\n${details}`)
            .then(() => {
                showMessage('ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'success');
            })
            .catch(() => {
                showMessage('Ø§Ù†Ù‚Ø± Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ ÙˆØ§Ø®ØªØ± "Ù†Ø³Ø®"', 'info');
            });
    }
}


        function trackOrder(orderId) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                z-index: 2000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
                animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 16px; padding: 30px; max-width: 400px; width: 100%; text-align: center;">
                    <div style="color: var(--primary); font-size: 4rem; margin-bottom: 20px;">
                        <i class="fas fa-truck"></i>
                    </div>
                    
                    <h3 style="color: var(--gray-800); margin-bottom: 15px;">
                        ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ #${orderId}
                    </h3>
                    
                    <p style="color: var(--gray-600); margin-bottom: 25px; line-height: 1.6;">
                        Ù…ÙŠØ²Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹. 
                        Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø¶Ø§ÙØ© Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù‚Ø±ÙŠØ¨Ø§Ù‹.
                    </p>
                    
                    <div style="background: var(--gray-100); padding: 20px; border-radius: 10px; margin-bottom: 25px;">
                        <p style="color: var(--gray-800); font-weight: bold; margin-bottom: 10px;">
                            ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©:
                        </p>
                        <a href="tel:01234522133" 
                           style="color: var(--primary); text-decoration: none; font-size: 1.2rem; font-weight: bold;">
                            <i class="fas fa-phone"></i>
                            01234522133
                        </a>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 10px; cursor: pointer; font-weight: bold;">
                        Ø­Ø³Ù†Ø§Ù‹
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function printOrder(orderId) {
            window.print();
        }
        
        function shareOrder(orderId) {
            if (navigator.share) {
                navigator.share({
                    title: `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #${orderId}`,
                    text: `ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨ÙŠ Ù…Ù† ØµÙŠØ¯Ù„ÙŠØ© Ø³Ø§Ø±Ø© Ø§Ù„Ø¹Ø¬Ø±Ù…ÙŠ - Ø§Ù„Ø·Ù„Ø¨ #${orderId}`,
                    url: window.location.href
                });
            } else {
                showMessage('Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø·Ù„Ø¨: Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†', 'info');
            }
        }
        
// Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù„Ø­Ø¸ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ù€ Backend (Ø¨Ø¯ÙˆÙ† Ù…ÙØ§ØªÙŠØ­)
function subscribeToOrderUpdates() {
    if (!clientId) return;

    console.log("ğŸ”” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù„Ø­Ø¸ÙŠØ©...");

    // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ Route Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£Ù†Ø§Ù‡ ÙÙŠ Ø§Ù„Ù€ Backend
    const eventSource = new EventSource(`${API_BASE}/orders/watch/${clientId}`);

    eventSource.onmessage = (event) => {
        try {
            const data = JSON.parse(event.data);
            console.log('âœ… Ø§Ø³ØªÙ„Ø§Ù… ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±:', data);
            
            // Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù…Ù† Ø§Ù„Ù€ Backend Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø±Ù‚Ø§Ø¨Ø©
            fetchOrderDetailsFromBackend(data.orderId);
        } catch (e) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:", e);
        }
    };

    eventSource.onerror = (err) => {
        console.error("âš ï¸ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§ØªØŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù...");
        eventSource.close();
        setTimeout(subscribeToOrderUpdates, 5000);
    };
}

// Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Ø§Ù„Ù€ Backend ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
async function fetchOrderDetailsFromBackend(orderId) {
    try {
        const response = await fetch(`${API_BASE}/orders/${orderId}`);
        const result = await response.json();

        if (result.success) {
            const order = result.data.order || result.data;
            
            // ØªØ­Ø¯ÙŠØ« Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
            const orderCard = document.querySelector(`[data-order-id="${order.id}"]`);
            if (orderCard) {
                const statusContainer = orderCard.querySelector('.order-status');
                const statusInfo = getStatusInfo(order.order_state || order.status);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´ÙƒÙ„ ÙˆØ§Ù„Ù†Øµ
                statusContainer.className = `order-status ${statusInfo.class}`;
                statusContainer.innerHTML = `<i class="${statusInfo.icon}"></i> ${statusInfo.text}`;
                
                // ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ø®ÙÙŠÙ (Pulse)
                orderCard.style.transition = 'all 0.5s';
                orderCard.style.boxShadow = '0 0 20px rgba(79, 70, 229, 0.4)';
                setTimeout(() => { orderCard.style.boxShadow = ''; }, 2000);

                showMessage(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ #${orderId} Ø¥Ù„Ù‰: ${statusInfo.text}`, 'info');
            } else {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ ÙˆØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£ØµÙ„Ø§Ù‹
                loadOrders();
            }
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ù€ Backend:', error);
    }
}

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            const storedClient = localStorage.getItem('client');
            const authTime = localStorage.getItem('auth_time');
            
            if (!storedClient || !authTime) {
                showMessage('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø© (24 Ø³Ø§Ø¹Ø©)
            const timeDiff = Date.now() - parseInt(authTime);
            const hoursDiff = timeDiff / (1000 * 60 * 60);
            
            if (hoursDiff > 24) {
                localStorage.removeItem('client');
                localStorage.removeItem('auth_time');
                localStorage.removeItem('client_id');
                showMessage('Ø§Ù†ØªÙ‡Øª Ø¬Ù„Ø³ØªÙƒØŒ ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }
            
            clientData = JSON.parse(storedClient);
            clientId = clientData.id;

            subscribeToOrderUpdates();
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
            document.getElementById('clientInfo').innerHTML = `
                <div class="client-badge">
                    <div class="client-name">
                        <i class="fas fa-user-circle"></i>
                        Ù…Ø±Ø­Ø¨Ø§Ù‹ ${clientData.name}
                    </div>
                    <div class="client-address">
                        <i class="fas fa-map-marker-alt"></i>
                        ${clientData.address || 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†'}
                    </div>
                </div>
            `;
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
            loadOrders();
            
            // Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                if (document.visibilityState === 'visible') {
                    loadOrders();
                }
            }, 30000);
        });
    </script>
</body>
</html>
