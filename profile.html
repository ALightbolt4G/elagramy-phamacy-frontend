<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ - ØµÙŠØ¯Ù„ÙŠØ© Ø³Ø§Ø±Ø© Ø§Ù„Ø¹Ø¬Ø±Ù…ÙŠ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
            min-height: 100vh;
        }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }
        .back-btn:hover { background: rgba(255, 255, 255, 0.3); }
        .profile-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .avatar {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
        }
        .profile-info h2 { margin-bottom: 5px; }
        .profile-info p { color: #666; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        .stat-label { color: #666; font-size: 0.9rem; }
        
        /* ØªØµÙ…ÙŠÙ… Ù‚Ø³Ù… Ø§Ù„ÙØ±ÙˆØ¹ */
        .branches-section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        .branches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .branch-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
            position: relative;
        }
        .branch-card.registered {
            border-color: #48bb78;
            background: rgba(72, 187, 120, 0.05);
        }
        .branch-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .branch-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .branch-icon {
            width: 40px;
            height: 40px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .branch-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2d3748;
        }
        .branch-details {
            font-size: 0.9rem;
            color: #718096;
            margin: 5px 0;
        }
        .branch-phone {
            color: #48bb78;
            font-weight: 500;
        }
        .status-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #48bb78;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        .register-btn {
            width: 100%;
            margin-top: 10px;
            padding: 8px 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }
        .register-btn:hover {
            background: #5a67d8;
        }
        .register-btn.registered {
            background: #c6f6d5;
            color: #22543d;
        }
        .register-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
        }
        
        .form-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; color: #444; }
        input, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        textarea { min-height: 80px; resize: vertical; }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        .primary-btn {
            background: #667eea;
            color: white;
        }
        .primary-btn:hover { background: #5a67d8; transform: translateY(-2px); }
        .secondary-btn {
            background: #e2e8f0;
            color: #4a5568;
        }
        .secondary-btn:hover { background: #cbd5e0; }
        .danger-btn {
            background: #fc8181;
            color: white;
        }
        .danger-btn:hover { background: #f56565; }
        .message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        .success { background: rgba(72, 187, 120, 0.2); color: #22543d; }
        .error { background: rgba(245, 101, 101, 0.2); color: #742a2a; }
        .info { background: rgba(66, 153, 225, 0.2); color: #2a4365; }
        .logout-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(245, 101, 101, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }
        .logout-btn:hover { background: #f56565; }
        
        @media (max-width: 768px) {
            .profile-header { flex-direction: column; text-align: center; }
            .stats-grid { grid-template-columns: 1fr; }
            .btn-group { flex-direction: column; }
            .branches-grid { grid-template-columns: 1fr; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <button class="back-btn" onclick="window.location.href='index.html'">
                <span>â†</span> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </button>
            <h1>ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h1>
        </header>
        
        <div id="message" class="message"></div>
        
        <div class="profile-container" id="profileContainer">
            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        </div>
        
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </button>
    </div>

    <script>
    const API_BASE = 'https://elagramy-phamacy-production.up.railway.app/api';
    let clientData = null;
    let availableBranches = [];
    let clientBranches = [];
    
    function showMessage(text, type = 'info') {
        const msgDiv = document.getElementById('message');
        msgDiv.textContent = text;
        msgDiv.className = `message ${type}`;
        msgDiv.style.display = 'block';
        
        setTimeout(() => {
            msgDiv.style.display = 'none';
        }, 5000);
    }
    
    function formatDate(dateString) {
        if (!dateString) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        const date = new Date(dateString);
        return date.toLocaleDateString('ar-EG', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }
    
    // Ø¬Ù„Ø¨ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©
    async function loadAvailableBranches() {
        try {
            console.log('ğŸª Ø¬Ù„Ø¨ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©...');
            const response = await fetch(`${API_BASE}/branches`);
            const data = await response.json();
            console.log('ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±ÙˆØ¹:', data);
            
            if (data.success) {
                availableBranches = data.data;
                return data.data;
            }
            return [];
        } catch (error) {
            console.error('Error loading branches:', error);
            return [];
        }
    }
    
    // Ø¬Ù„Ø¨ ÙØ±ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¬Ù„ ÙÙŠÙ‡Ø§
    async function loadClientBranches() {
        const clientId = localStorage.getItem('client_id');
        console.log('ğŸ” Ø¬Ù„Ø¨ ÙØ±ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„:', { clientId, clientData });
        
        if (!clientId) {
            console.warn('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ client_id ÙÙŠ localStorage');
            return [];
        }
        
        try {
            const response = await fetch(`${API_BASE}/clients/${clientId}/branches`);
            const data = await response.json();
            console.log('ğŸ“Š ÙØ±ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„:', data);
            
            if (data.success && data.data) {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„ÙØ±ÙˆØ¹ Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
                const branchIds = data.data.map(item => {
                    return item.branch_id || (item.branches && item.branches.id) || item.id;
                }).filter(id => id); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‚ÙŠÙ… undefined/null
                
                console.log('ğŸ¯ Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:', branchIds);
                clientBranches = branchIds;
                return branchIds;
            }
            return [];
        } catch (error) {
            console.error('Error loading client branches:', error);
            return [];
        }
    }
    
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ ÙØ±Ø¹
    // ÙÙŠ profile.html - Ø£ØµÙ„Ø­ Ø¯Ø§Ù„Ø© registerToBranch
async function registerToBranch(branchId) {
    const clientId = localStorage.getItem('client_id');
    
    console.log('ğŸ“¤ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±Ø¹:', { 
        clientId, 
        branchId
    });
    
    if (!clientId || !branchId) {
        console.error('âŒ Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ÙƒØ§ÙÙŠØ©:', { clientId, branchId });
        throw new Error('Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ§Ù„ÙØ±Ø¹ Ù…Ø·Ù„ÙˆØ¨Ø§Ù†');
    }
    
    try {
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… Ø¥Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù…
        const clientIdNum = parseInt(clientId);
        const branchIdNum = parseInt(branchId);
        
        console.log('ğŸ”¢ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙˆÙ„Ø©:', { 
            clientIdNum, 
            branchIdNum
        });
        
        // Ø¥Ø±Ø³Ø§Ù„ camelCase Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† snake_case
        const requestData = {
            clientId: clientIdNum,    // camelCase
            branchId: branchIdNum     // camelCase
        };
        
        console.log('ğŸ“¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© (camelCase):', JSON.stringify(requestData));
        
        const response = await fetch(`${API_BASE}/clients/register-branch`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify(requestData)
        });
        
        console.log('ğŸ“¡ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', response.status);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('âŒ Ù†Øµ Ø§Ù„Ø®Ø·Ø£:', errorText);
            throw new Error(`HTTP ${response.status}`);
        }
        
        const data = await response.json();
        console.log('âœ… Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', data);
        
        if (!data.success) {
            throw new Error(data.message || 'ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±Ø¹');
        }
        
        return { 
            success: true, 
            already_registered: data.already_registered || false,
            data: data.data 
        };
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±Ø¹:', error);
        throw error;
    }
}


    async function loadProfile() {
        console.log('ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ...');
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©
        let client = localStorage.getItem('client');
        let clientId = localStorage.getItem('client_id');
        
        if (!client && !clientId) {
            console.warn('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ³Ø¬ÙŠÙ„');
            window.location.href = 'login.html';
            return;
        }
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ø®Ø²Ù†Ø§Ù‹ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡
        if (client) {
            try {
                clientData = JSON.parse(client);
                console.log('ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† localStorage:', clientData);
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:', error);
            }
        }
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ clientData Ù„ÙƒÙ† Ù‡Ù†Ø§Ùƒ client_idØŒ Ø­Ø§ÙˆÙ„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if ((!clientData || !clientData.id) && clientId) {
            console.log('ğŸ” Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...');
            try {
                const response = await fetch(`${API_BASE}/clients/${clientId}`);
                const data = await response.json();
                
                if (data.success) {
                    clientData = data.data;
                    localStorage.setItem('client', JSON.stringify(data.data));
                    console.log('âœ… ØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:', clientData);
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:', error);
            }
        }
        
        // Ø¥Ø°Ø§ Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø£Ø¹Ø¯ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
        if (!clientData || !clientData.id) {
            console.warn('âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
            window.location.href = 'login.html';
            return;
        }
        
        console.log('ğŸ¯ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:', clientData);
        await displayProfile();
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        try {
            console.log('ğŸ“Š Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª...');
            const response = await fetch(`${API_BASE}/clients/${clientData.id}/orders/all`);
            const data = await response.json();
            
            if (data.success) {
                console.log('ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨Ø§Øª:', data);
                updateStatistics(data.data);
            }
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
        }
    }
    
    async function displayProfile() {
        const container = document.getElementById('profileContainer');
        
        if (!container || !clientData) {
            console.error('âŒ Ø¹Ù†ØµØ± Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
            return;
        }
        
        const firstLetter = clientData.name ? clientData.name.charAt(0).toUpperCase() : '?';
        const phone = clientData.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const address = clientData.address || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        const createdAt = clientData.created_at || new Date().toISOString();
        
        // Ø¬Ù„Ø¨ Ø§Ù„ÙØ±ÙˆØ¹
        console.log('ğŸ”„ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±ÙˆØ¹...');
        await Promise.all([loadAvailableBranches(), loadClientBranches()]);
        console.log('âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…Ø­Ù…Ù„Ø©:', { availableBranches, clientBranches });
        
        container.innerHTML = `
            <div class="profile-header">
                <div class="avatar">${firstLetter}</div>
                <div class="profile-info">
                    <h2>${clientData.name || 'Ù…Ø³ØªØ®Ø¯Ù…'}</h2>
                    <p><i class="fas fa-phone"></i> ${phone}</p>
                    <p><i class="fas fa-map-marker-alt"></i> ${address}</p>
                    <p><i class="fas fa-calendar"></i> Ø¹Ø¶Ùˆ Ù…Ù†Ø° ${formatDate(createdAt)}</p>
                </div>
            </div>
            
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="deliveredOrders">0</div>
                    <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ù…Ø³Ù„Ù…Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingOrders">0</div>
                    <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
            </div>
            
            <!-- Ù‚Ø³Ù… Ø§Ù„ÙØ±ÙˆØ¹ -->
            <div class="branches-section">
                <h3><i class="fas fa-store"></i> Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…Ø³Ø¬Ù„ ÙÙŠÙ‡Ø§</h3>
                <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„ØªÙ„Ù‚ÙŠ Ø§Ù„Ø¹Ø±ÙˆØ¶ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©:</p>
                
                <div id="branchesList" class="branches-grid">
                    ${renderBranchesList()}
                </div>
            </div>
            
            <div class="form-section">
                <h3><i class="fas fa-edit"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                
                <div class="form-group">
                    <label for="editName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
                    <input type="text" id="editName" value="${clientData.name || ''}" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
                </div>
                
                <div class="form-group">
                    <label for="editPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                    <input type="tel" id="editPhone" value="${phone}" placeholder="01XXXXXXXXX" readonly>
                </div>
                
                <div class="form-group">
                    <label for="editAddress">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ:</label>
                    <textarea id="editAddress" placeholder="Ø´Ø§Ø±Ø¹ØŒ Ù…Ø¨Ù†Ù‰ØŒ Ø´Ù‚Ø©ØŒ Ù…Ø¹Ù„Ù… Ø¨Ø§Ø±Ø²">${address}</textarea>
                </div>
                
                <div class="btn-group">
                    <button class="primary-btn" onclick="updateProfile()">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                    </button>
                    <button class="secondary-btn" onclick="cancelEdit()">
                        <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                    </button>
                </div>
            </div>
            
            <div class="form-section">
                <h3><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                
                <div class="btn-group">
                    <button class="secondary-btn" onclick="viewOrderHistory()">
                        <i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„
                    </button>
                    <button class="danger-btn" onclick="deleteAccount()">
                        <i class="fas fa-trash"></i> Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨
                    </button>
                </div>
            </div>
        `;
    }
    
    function renderBranchesList() {
        if (!availableBranches || availableBranches.length === 0) {
            return '<p style="text-align: center; color: #666; grid-column: 1/-1;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±ÙˆØ¹...</p>';
        }
        
        console.log('ğŸ¨ Ø±Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙˆØ¹:', { 
            totalBranches: availableBranches.length,
            registeredBranches: clientBranches 
        });
        
        return availableBranches.map(branch => {
            const isRegistered = clientBranches.includes(branch.id);
            console.log(`ğŸ“‹ Ø§Ù„ÙØ±Ø¹ ${branch.id}: ${branch.name} - Ù…Ø³Ø¬Ù„: ${isRegistered}`);
            
            return `
                <div class="branch-card ${isRegistered ? 'registered' : ''}">
                    ${isRegistered ? '<span class="status-badge">Ù…Ø³Ø¬Ù„</span>' : ''}
                    <div class="branch-header">
                        <div class="branch-icon">
                            <i class="fas fa-store"></i>
                        </div>
                        <div>
                            <div class="branch-name">${branch.name || 'ÙØ±Ø¹ Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©'}</div>
                        </div>
                    </div>
                    <div class="branch-details">
                        <p><i class="fas fa-map-marker-alt"></i> ${branch.address || 'ÙƒØ¹Ø¨ÙŠØ´ - ÙÙŠØµÙ„'}</p>
                        <p class="branch-phone"><i class="fas fa-phone"></i> ${branch.phone || '01234522133'}</p>
                    </div>
                    <button 
                        class="register-btn ${isRegistered ? 'registered' : ''}" 
                        onclick="handleBranchRegistration(${branch.id})"
                        ${isRegistered ? 'disabled' : ''}
                        id="branchBtn_${branch.id}"
                    >
                        ${isRegistered ? 
                            '<i class="fas fa-check-circle"></i> Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„' : 
                            '<i class="fas fa-sign-in-alt"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙØ±Ø¹'}
                    </button>
                </div>
            `;
        }).join('');
    }
    
    async function handleBranchRegistration(branchId) {
        console.log('ğŸ¯ Ø¨Ø¯Ø¡ ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±Ø¹:', branchId);
        
        const button = document.getElementById(`branchBtn_${branchId}`);
        if (!button) {
            console.error(`âŒ Ø²Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: branchBtn_${branchId}`);
            showMessage('Ø¹Ù†ØµØ± Ø§Ù„Ø²Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
            return;
        }
        
        const originalText = button.innerHTML;
        
        try {
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ client_id Ù…Ù† localStorage
            const clientId = localStorage.getItem('client_id');
            if (!clientId) {
                throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…ÙŠÙ„. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
            }
            
            console.log('ğŸ“¤ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±Ø¹:', { clientId, branchId });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±Ø¹
            const result = await registerToBranch(branchId);
            
            if (result.success) {
                if (result.already_registered) {
                    showMessage('Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙØ±Ø¹', 'info');
                } else {
                    showMessage('ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±Ø¹ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 'success');
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±Ø¹ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
                    if (!clientBranches.includes(branchId)) {
                        clientBranches.push(branchId);
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    const branchCard = button.closest('.branch-card');
                    if (branchCard) {
                        branchCard.classList.add('registered');
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
                        if (!branchCard.querySelector('.status-badge')) {
                            const statusBadge = document.createElement('span');
                            statusBadge.className = 'status-badge';
                            statusBadge.textContent = 'Ù…Ø³Ø¬Ù„';
                            branchCard.prepend(statusBadge);
                        }
                    }
                }
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø±
                button.innerHTML = '<i class="fas fa-check-circle"></i> Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„';
                button.classList.add('registered');
                
            } else {
                throw new Error('ÙØ´Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„ÙØ±Ø¹');
            }
            
        } catch (error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ±Ø¹:', error);
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
            let errorMessage = error.message;
            if (error.message.includes('Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…ÙŠÙ„')) {
                errorMessage = 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
            } else if (error.message.includes('HTTP 400')) {
                errorMessage = 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
            } else if (error.message.includes('Failed to fetch')) {
                errorMessage = 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª';
            }
            
            showMessage(errorMessage, 'error');
            
            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø§Ù„Ø£ØµÙ„ÙŠØ©
            button.innerHTML = originalText;
            button.disabled = false;
        }
    }
    
    function updateStatistics(orders) {
        if (!orders) return;
        
        const totalOrders = orders.length || 0;
        const deliveredOrders = orders.filter(o => o.order_state === 'delivered').length || 0;
        const pendingOrders = orders.filter(o => o.order_state === 'pending').length || 0;
        
        const totalEl = document.getElementById('totalOrders');
        const deliveredEl = document.getElementById('deliveredOrders');
        const pendingEl = document.getElementById('pendingOrders');
        
        if (totalEl) totalEl.textContent = totalOrders;
        if (deliveredEl) deliveredEl.textContent = deliveredOrders;
        if (pendingEl) pendingEl.textContent = pendingOrders;
    }
    
    async function updateProfile() {
    const name = document.getElementById('editName')?.value.trim();
    const address = document.getElementById('editAddress')?.value.trim();
    
    if (!name || !address) {
        showMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
        return;
    }
    
    const clientId = localStorage.getItem('client_id');
    if (!clientId) {
        showMessage('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰', 'error');
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 1500);
        return;
    }
    
    showMessage('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª...', 'info');
    
    try {
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
        const response = await fetch(`${API_BASE}/clients/${clientId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: name,
                address: address
            })
        });
        
        console.log('ğŸ“¤ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„:', response.status);
        
        if (response.ok) {
            const data = await response.json();
            console.log('âœ… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­Ø¯ÙŠØ«:', data);
            
            if (data.success) {
                // ØªØ­Ø¯ÙŠØ« localStorage
                const updatedClient = {
                    ...clientData,
                    name: name,
                    address: address,
                    updated_at: new Date().toISOString()
                };
                
                localStorage.setItem('client', JSON.stringify(updatedClient));
                clientData = updatedClient;
                
                showMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…', 'success');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                setTimeout(() => {
                    displayProfile();
                }, 1000);
            } else {
                throw new Error(data.message || 'ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±');
            }
        } else if (response.status === 404) {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù€ endpoint Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·
            console.warn('âš ï¸ endpoint ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…ÙŠÙ„ ØºÙŠØ± Ù…ØªÙˆÙØ±ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
            saveToLocalOnly(name, address);
        } else {
            const errorText = await response.text();
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±:', errorText);
            throw new Error('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù:', error);
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®Ø·Ø£ Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£Ùˆ endpoint ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
        if (error.message.includes('Failed to fetch') || error.message.includes('404')) {
            saveToLocalOnly(name, address);
        } else {
            showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª: ' + error.message, 'error');
        }
    }
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·
function saveToLocalOnly(name, address) {
    const updatedClient = {
        ...clientData,
        name: name,
        address: address,
        updated_at: new Date().toISOString(),
        sync_status: 'local_only',
        last_sync_attempt: new Date().toISOString()
    };
    
    localStorage.setItem('client', JSON.stringify(updatedClient));
    clientData = updatedClient;
    
    // Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹
    savePendingUpdate(name, address);
    
    showMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹. Ø³ÙŠØªÙ… Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø²Ø§Ù…Ù†ØªÙ‡Ø§ Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØªØµØ§Ù„', 'info');
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
    setTimeout(() => {
        displayProfile();
    }, 1000);
}

// Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
function savePendingUpdate(name, address) {
    try {
        const clientId = localStorage.getItem('client_id');
        const pendingUpdates = JSON.parse(localStorage.getItem('pending_profile_updates') || '[]');
        
        pendingUpdates.push({
            type: 'profile_update',
            client_id: clientId,
            data: { name, address },
            timestamp: new Date().toISOString(),
            attempts: 0
        });
        
        localStorage.setItem('pending_profile_updates', JSON.stringify(pendingUpdates));
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        setTimeout(() => {
            trySyncPendingUpdates();
        }, 5000);
        
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©:', error);
    }
}

// Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
async function trySyncPendingUpdates() {
    const pendingUpdates = JSON.parse(localStorage.getItem('pending_profile_updates') || '[]');
    
    if (pendingUpdates.length === 0) return;
    
    for (const update of [...pendingUpdates]) {
        try {
            const response = await fetch(`${API_BASE}/clients/${update.client_id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(update.data)
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    const index = pendingUpdates.indexOf(update);
                    if (index > -1) {
                        pendingUpdates.splice(index, 1);
                    }
                    console.log('âœ… ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ');
                }
            }
        } catch (error) {
            console.log('âš ï¸ ÙØ´Ù„ Ù…Ø²Ø§Ù…Ù†Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:', error.message);
            update.attempts = (update.attempts || 0) + 1;
        }
    }
    
    // Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
    localStorage.setItem('pending_profile_updates', JSON.stringify(pendingUpdates));
}

    function cancelEdit() {
        displayProfile();
        showMessage('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª', 'info');
    }
    
    function viewOrderHistory() {
        window.location.href = 'orderstate.html';
    }
    
    function deleteAccount() {
        if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ÙƒØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡ØŒ ÙˆØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ·Ù„Ø¨Ø§ØªÙƒ.')) {
            showMessage('Ø¬Ø§Ø±ÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨...', 'info');
            
            // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
            setTimeout(() => {
                localStorage.removeItem('client');
                localStorage.removeItem('client_id');
                localStorage.removeItem('registered_branches');
                localStorage.removeItem('auth_time');
                showMessage('ØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©', 'info');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 1000);
            }, 1500);
        }
    }
    
    function logout() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
            localStorage.removeItem('client');
            localStorage.removeItem('client_id');
            localStorage.removeItem('registered_branches');
            localStorage.removeItem('auth_time');
            showMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1000);
        }
    }
    
    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ­ÙŠØ­
    function debugInfo() {
        console.log('=== Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­ ===');
        console.log('1. clientData:', clientData);
        console.log('2. localStorage client:', localStorage.getItem('client'));
        console.log('3. localStorage client_id:', localStorage.getItem('client_id'));
        console.log('4. availableBranches:', availableBranches);
        console.log('5. clientBranches:', clientBranches);
        console.log('6. localStorage registered_branches:', localStorage.getItem('registered_branches'));
        
        alert(`
            Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­:
            -----------------
            Ø§Ù„Ø¹Ù…ÙŠÙ„: ${clientData ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}
            ID Ø§Ù„Ø¹Ù…ÙŠÙ„: ${clientData?.id || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
            ID ÙÙŠ localStorage: ${localStorage.getItem('client_id')}
            Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©: ${availableBranches?.length || 0}
            Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±ÙˆØ¹ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©: ${clientBranches?.length || 0}
        `);
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø²Ø± ØªØµØ­ÙŠØ­ Ù…Ø¤Ù‚Øª
    function addDebugButton() {
        const debugBtn = document.createElement('button');
        debugBtn.innerHTML = 'ğŸ› ØªØµØ­ÙŠØ­';
        debugBtn.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            z-index: 1000;
        `;
        debugBtn.onclick = debugInfo;
        document.body.appendChild(debugBtn);
    }
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', async () => {
        console.log('ğŸš€ ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ...');
        
        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„ØªØµØ­ÙŠØ­ (ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
        addDebugButton();
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
        await loadProfile();
        
        // ØªØ­Ù‚Ù‚ Ø¯ÙˆØ±ÙŠ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±
        setInterval(async () => {
            try {
                await fetch(`${API_BASE}/health`);
            } catch (error) {
                console.warn('âš ï¸ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
            }
        }, 30000);
    });
</script>
</body>
</html>
